

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Verilog Handnotes 02 —— 代码规范 &mdash; Handnotes 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/my.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SystemVerilog Handnotes" href="../systemverilog/index.html" />
    <link rel="prev" title="Verilog Handnotes 01 —— 大规模逻辑设计指导书" href="Verilog%20Handnotes%2001.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Handnotes
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Verilog Handnotes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Verilog%20Handnotes%2001.html">Verilog Handnotes 01 —— 大规模逻辑设计指导书 </a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Verilog Handnotes 02 —— 代码规范 </a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">笔记</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#verilog">Verilog语言编写规范</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">典型电路</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">异步处理</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id10">待解决(包括问题)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../systemverilog/index.html">SystemVerilog Handnotes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Handnotes</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Verilog Handnotes</a> &raquo;</li>
        
      <li>Verilog Handnotes 02 —— 代码规范 </li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/verilog/Verilog Handnotes 02.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="verilog-handnotes-02">
<h1>Verilog Handnotes 02 —— 代码规范 <a class="footnote-reference brackets" href="#id12" id="id1">1</a><a class="headerlink" href="#verilog-handnotes-02" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id2">
<h2>笔记<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="verilog">
<h3>Verilog语言编写规范<a class="headerlink" href="#verilog" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>宏在整个编译期都有效, 在一个文件中定义宏, 那么在其后编译的所有文件都可以调用, 直到遇到`undef关键词, 为避免文件编译顺序不同导致编译结果不同, 不推荐在文件中使用`define, `undef关键词进行宏操作</p></li>
<li><p>避免使用宏定义值</p></li>
<li><p>对于是需要通过宏判断完成调式的代码(如debug info)的选择编译, 要求不定义该宏为默认情况, 即不定义宏的情况不展开宏代码</p></li>
<li><p>用parameter定义端口参数</p></li>
<li><p>用localparameter定义模块内参数</p></li>
<li><p>`timescale step/precision timescale可按文件定义, 编译时, 若该文件指定了timescale则编译该文件后文件的timescale与指定值一致, 并沿用至下一个文件, 知道再次定义timescale。因此, 不同文件可能工作于不同的timescale, 可能导致后仿时Foundry库中specify定义的延迟混乱, 以及其他的时间步进错误；不同文件工作于不同的timescale, 每个timescale在仿真器处理时都存在于不同的分片下, 容易造成多分片交互的竞争与冒险</p></li>
<li><p>判断(比较)时要求匹配位宽</p></li>
<li><p>可变向量</p></li>
</ul>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="k">genvar</span> <span class="n">i</span><span class="p">;</span>
<span class="k">generate</span>
    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mh">1</span><span class="p">)</span> <span class="k">begin</span> <span class="o">:</span> <span class="n">data_montage</span>
        <span class="k">assign</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mh">8</span> <span class="o">+</span> <span class="mh">7</span> <span class="o">-:</span> <span class="mh">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">ram</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mh">8</span> <span class="o">+</span> <span class="mh">7</span> <span class="o">-:</span> <span class="mh">8</span><span class="p">];</span> <span class="c1">// start_bit-: width, 表示从start_bit开始递减, 位宽为width；start_bit+: width与之类似</span>
        <span class="c1">// assign data[i * 8 + 7: i * 8 - 7] = ram[i * 8 + 7: i * 8 - 7];</span>
    <span class="k">end</span>
<span class="k">endgenerate</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">channel</span><span class="p">;</span>
<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="n">curr_data</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">[</span><span class="n">channel</span> <span class="o">*</span> <span class="mh">8</span> <span class="o">+</span> <span class="mh">7</span> <span class="o">-:</span> <span class="mh">8</span><span class="p">];</span> <span class="c1">// 会被综合成选择器, 注意data的最大位宽</span>
<span class="k">end</span>
</pre></div>
</div>
<p>会被综合成选自额</p>
<ul class="simple">
<li><p>向量方向
参考 Verilog Handnotes 01 <a class="reference internal" href="Verilog%20Handnotes%2001.html#verilog"><span class="std std-ref">Verilog语言编写规范</span></a> 的MSB/LSB部分</p></li>
</ul>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// 简而言之 data[MSB:LSB]在显示时也是[左MSB-LSB右]</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data1</span><span class="p">;</span>
<span class="n">data1</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h0</span><span class="p">;</span>
<span class="n">data1</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h1</span><span class="p">;</span>
<span class="n">data1</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h2</span><span class="p">;</span>
<span class="n">data1</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h3</span><span class="p">;</span>
<span class="c1">// data1 = 16&#39;h0123;</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">3</span><span class="p">][</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data2</span><span class="p">;</span>
<span class="n">data2</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h0</span><span class="p">;</span>
<span class="n">data2</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h1</span><span class="p">;</span>
<span class="n">data2</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h2</span><span class="p">;</span>
<span class="n">data2</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h3</span><span class="p">;</span>
<span class="c1">// data2 = 16&#39;h0123;</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data3</span><span class="p">;</span>
<span class="n">data3</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
<span class="n">data3</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="n">data3</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="n">data3</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="c1">// data3 = 4&#39;b1000;</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">3</span><span class="p">]</span> <span class="n">data4</span><span class="p">;</span>
<span class="n">data4</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
<span class="n">data4</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="n">data4</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="n">data4</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
<span class="c1">// data4 = 4&#39;b1000;</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data5</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<span class="n">data5</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h0</span><span class="p">;</span>
<span class="n">data5</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h1</span><span class="p">;</span>
<span class="n">data5</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h2</span><span class="p">;</span>
<span class="n">data5</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h3</span><span class="p">;</span>
<span class="c1">// data5 = 16&#39;h0123;</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">3</span><span class="p">]</span> <span class="n">data6</span><span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<span class="n">data6</span><span class="p">[</span><span class="mh">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h0</span><span class="p">;</span>
<span class="n">data6</span><span class="p">[</span><span class="mh">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h1</span><span class="p">;</span>
<span class="n">data6</span><span class="p">[</span><span class="mh">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h2</span><span class="p">;</span>
<span class="n">data6</span><span class="p">[</span><span class="mh">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">4&#39;h3</span><span class="p">;</span>
<span class="n">data</span><span class="p">[</span><span class="mh">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">16&#39;h0123</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>&gt;&gt;&gt;与&lt;&lt;&lt;用于算术移位, 将符号位填补移出的位</p></li>
<li><p>在case中可以用default表示最后一个分支以提高代码覆盖率</p></li>
<li><p>always敏感变量列表中避免出现双时钟沿或双沿出发条件</p></li>
<li><p>always敏感变量列表中复位建议采用下降沿, 以降低毛刺风险, 建议使用同步复位, 以降低recovery-time和remove-time风险</p></li>
<li><p>禁止不加保护或反馈的情况下使用两套电路经相同输入信号分别描述产生相关联信号, 当时钟不稳定产生亚稳态或寄存器发生异常跳变时, 相关联信号发生不可纠偏离, 导致电路不可自动恢复</p></li>
</ul>
<img alt="../_images/conflict.png" src="../_images/conflict.png" />
<ul class="simple">
<li><p>使用always(*)描述组合逻辑时可以并列使用if语句, 执行顺序是从上至下, 有多少个条件被满足就会被执行多少次, 但在时序逻辑中不同, 使用这种语法需要特别注意对综合时序的影响</p></li>
<li><p>generate块配合if可以用于代码选择, 默认当条件不满足时, 部分代码不会被综合, 用以代替宏(全局有效), 可以实现由模块参数列表进行传递从而控制每个模块</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>典型电路<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id4">
<h4>时钟和复位<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>继续强调在设计中使用统一的时钟沿触发, 避免使用内部产生时钟及门控时钟(内部产生的时钟信号不能作为扫描链的一部分, 限制了芯片的可测性, 而且综合时很难进行时序约束), 若设计中用到多个时钟, 须将时钟产生模块在顶层单独放置, 保证每个模块只使用一个是时钟信号, 便于layout时时钟树优化</p></li>
<li><p>时钟信号不能做数据使用</p></li>
<li><p>复位信号的处理与时钟信号类似</p></li>
</ul>
</div>
<div class="section" id="id5">
<h4>资源共享<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>资源共享尽量共享复杂运算单元, 可以采用函数来定义；采用括号等方式控制综合结果, 实现资源共享</p></li>
</ul>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// not recommended</span>
<span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="mh">2</span><span class="mi">&#39;d0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">sum</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kt">reg</span> <span class="n">temp1</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">temp2</span><span class="p">;</span>

<span class="c1">// recommended, 综合后实现了加法器的复用</span>
<span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
    <span class="n">temp1</span> <span class="o">=</span> <span class="mh">1</span><span class="mi">&#39;d0</span><span class="p">;</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="mh">1</span><span class="mi">&#39;d0</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">sum</span> <span class="o">=</span> <span class="n">temp1</span> <span class="o">+</span> <span class="n">temp2</span><span class="p">;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="c1">// not recommended</span>
<span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">;</span>
<span class="k">end</span>

<span class="c1">// recommended, 综合后实现了运算结果的服用</span>
<span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="fifo">
<h4>FIFO<a class="headerlink" href="#fifo" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>异步FIFO采用将二进制地址转换为格雷码地址的方法</p></li>
</ul>
</div>
<div class="section" id="id6">
<h4>状态机<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>状态机状态编码的选择 <a class="footnote-reference brackets" href="#id13" id="id7">2</a></p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 34%" />
<col style="width: 53%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>编码类型</p></th>
<th class="head"><p>优点</p></th>
<th class="head"><p>缺点</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Binary</p></td>
<td><p>编码位宽小</p></td>
<td><p>译码逻辑复杂, 消耗资源多, 无法避免毛刺</p></td>
</tr>
<tr class="row-odd"><td><p>Gray</p></td>
<td><p>编码位宽小</p></td>
<td><p>译码逻辑复杂, 消耗资源多</p></td>
</tr>
<tr class="row-even"><td><p>One-hot</p></td>
<td><p>组合逻辑简单, 运行频率高</p></td>
<td><p>无法避免毛刺</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>在模块划分时, 把状态机分离出来, 便于综合工具对状态机进行优化</p></li>
<li><dl class="simple">
<dt>推荐使用三段式FSM描述方法:</dt><dd><ol class="arabic simple">
<li><p>第一个always块, 描述采用同步时序逻辑的状态转移</p></li>
<li><p>第二个always块, 描述组合逻辑判断状态转移条件</p></li>
<li><p>第三个always块, 使用同步时序逻辑描述每个状态的输出</p></li>
</ol>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="id8">
<h4>乒乓操作<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>乒乓操作常用于数据流的控制处理中, 在流水线处理中, 完成数据的无缝缓冲与处理</p></li>
</ul>
<img alt="../_images/pingpang.png" src="../_images/pingpang.png" />
</div>
</div>
<div class="section" id="id9">
<h3>异步处理<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>跨时钟域(CDC, Clock Domain Crossing)</p></li>
<li><p>跨时钟域可能存在的问题有：</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>组合毛刺</p></li>
<li><p>数据丢失</p></li>
<li><p>多路扇出</p></li>
<li><p>信号汇聚</p></li>
<li><p>异步复位释放不可靠</p></li>
</ol>
</div></blockquote>
</li>
<li><p>组合毛刺</p></li>
</ul>
<img alt="../_images/glitch.png" src="../_images/glitch.png" />
</div>
</div>
<div class="section" id="id10">
<h2>待解决(包括问题)<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p><input checked=""  type="checkbox"> 多维压缩数组向量方向</p></li>
<li><p><input checked=""  type="checkbox"> 乒乓操作典型代码 <a class="footnote-reference brackets" href="#id14" id="id11">3</a></p></li>
<li><p><input type="checkbox"> 同步、异步FIFO典型代码</p></li>
</ol>
<dl class="footnote brackets">
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>读书笔记(代码规范)基于Verilog-2001规范 2020-12-11</p>
</dd>
<dt class="label" id="id13"><span class="brackets"><a class="fn-backref" href="#id7">2</a></span></dt>
<dd><p>结合Verilog Handnotes 01 <a class="reference internal" href="Verilog%20Handnotes%2001.html#vhdl"><span class="std std-ref">VHDL数字电路设计指导</span></a> , 三种编码的状态空间不同, 因此对于非法状态的检测所需的电路逻辑代价也不同</p>
</dd>
<dt class="label" id="id14"><span class="brackets"><a class="fn-backref" href="#id11">3</a></span></dt>
<dd><p>乒乓操作典型代码
示例中用flag信号翻转完成乒乓操作的指示
Buffer写侧：fifo1在flag=0时连续写入8拍的输入数据, 而fifo2在flag=1时连续写入8拍的输入数据
Buffer读侧：fifo1在flag=1时连续读出8拍缓存的数据, 而fifo2在flag=0时连续读出8拍缓存的数据</p>
</dd>
</dl>
<div class="highlight-verilog notranslate"><div class="highlight"><pre><span></span><span class="k">module</span> <span class="n">pingpang_example</span><span class="p">(</span>
    <span class="k">input</span> <span class="kt">wire</span> <span class="n">clk</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span> <span class="n">rst_n</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span> <span class="n">fifo1_empty</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span> <span class="n">fifo2_empty</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_in</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">fifo1_rd</span><span class="p">,</span>
    <span class="k">input</span> <span class="kt">wire</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">fifo2_rd</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span> <span class="n">fifo1_wren</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span> <span class="n">fifo2_wren</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span> <span class="n">fifo1_ren</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span> <span class="n">fifo2_ren</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">fifo1_wr_d</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">fifo2_wr_d</span><span class="p">,</span>
    <span class="k">output</span> <span class="kt">reg</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_out</span>
<span class="p">);</span>

<span class="kt">reg</span><span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">cnt_clk8</span><span class="p">;</span>

<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">cnt_clk8</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">cnt_clk8</span> <span class="o">&lt;=</span> <span class="n">cnt_clk8</span> <span class="o">+</span> <span class="mh">3</span><span class="mi">&#39;d1</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kt">reg</span> <span class="n">flag</span><span class="p">;</span>

<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">flag</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cnt_clk8</span> <span class="o">==</span> <span class="mh">3</span><span class="mi">&#39;d7</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">flag</span> <span class="o">&lt;=</span> <span class="o">~</span><span class="n">flag</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="kt">reg</span> <span class="n">flag_dly1</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">flag_dly2</span><span class="p">;</span>
<span class="kt">reg</span> <span class="n">flag_dly3</span><span class="p">;</span>

<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">flag_dly1</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
        <span class="n">flag_dly2</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
        <span class="n">flag_dly3</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">flag_dly1</span> <span class="o">&lt;=</span> <span class="n">flag</span><span class="p">;</span>
        <span class="n">flag_dly2</span> <span class="o">&lt;=</span> <span class="n">flag_dly1</span><span class="p">;</span>
        <span class="n">flag_dly3</span> <span class="o">&lt;=</span> <span class="n">flag_dly2</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>


<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">fifo1_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
        <span class="n">fifo2_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
        <span class="n">fifo1_wr_d</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
        <span class="n">fifo2_wr_d</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="k">case</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
            <span class="mh">1</span><span class="mb">&#39;b0</span><span class="o">:</span> <span class="k">begin</span>
                <span class="n">fifo1_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
                <span class="n">fifo2_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
                <span class="n">fifo1_wr_d</span> <span class="o">&lt;=</span> <span class="n">data_in</span><span class="p">;</span>
                <span class="n">fifo2_wr_d</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
            <span class="k">end</span>
            <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
                <span class="n">fifo1_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
                <span class="n">fifo2_wren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
                <span class="n">fifo1_wr_d</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
                <span class="n">fifo2_wr_d</span> <span class="o">&lt;=</span> <span class="n">data_in</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">endcase</span>
    <span class="k">end</span>
<span class="k">end</span>
    
        
<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">fifo1_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">flag_dly1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">fifo1_empty</span><span class="p">))</span> <span class="k">begin</span>
        <span class="n">fifo1_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">fifo1_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">fifo2_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="o">!</span><span class="n">flag_dly1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">fifo2_empty</span><span class="p">))</span> <span class="k">begin</span>
        <span class="n">fifo2_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="n">fifo2_ren</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
        <span class="n">data_out</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mb">&#39;b0</span><span class="p">;</span>
    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
        <span class="k">case</span> <span class="p">(</span><span class="n">flag_dly3</span><span class="p">)</span> 
            <span class="mh">1</span><span class="mb">&#39;b0</span><span class="o">:</span> <span class="k">begin</span>
                <span class="n">data_out</span> <span class="o">&lt;=</span> <span class="n">fifo2_rd</span><span class="p">;</span>
            <span class="k">end</span>
            <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
                <span class="n">data_out</span> <span class="o">&lt;=</span> <span class="n">fifo1_rd</span><span class="p">;</span>
            <span class="k">end</span>
        <span class="k">endcase</span>
    <span class="k">end</span>

<span class="k">endmodule</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../systemverilog/index.html" class="btn btn-neutral float-right" title="SystemVerilog Handnotes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Verilog%20Handnotes%2001.html" class="btn btn-neutral float-left" title="Verilog Handnotes 01 —— 大规模逻辑设计指导书" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, meuhor

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>